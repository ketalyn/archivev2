// Your JSON data
const jsonData = [
    {
      "item": "organizer",
      "positionchanges": 0,
      "color": "white, clear",
      "material": "plastic",
      "MDM": "DOESN'T MOVE",
      "image_url": "./assets/organizerrender.png"
    },
    {
      "item": "toothbrush",
      "positionchanges": 2,
      "color": "blue, white, orange",
      "material": "plastic, nylon",
      "MDM": "MOVES",
      "image_url": "./assets/toothbrush.gif"
    },
    {
        "item": "toothpaste",
        "positionchanges": 2,
        "color": "red, white",
        "material": "plastic",
        "MDM": "MOVES",
        "image_url": "./assets/toothpaste.gif"
      },
      {
        "item": "toner",
        "positionchanges": 2,
        "color": "blue, clear, white",
        "material": "plastic",
        "MDM": "MOVES",
        "image_url": "./assets/toner.gif"
      },
      {
        "item": "face lotion",
        "positionchanges": 2,
        "color": "white, blue, pink",
        "material": "plastic",
        "MDM": "MOVES",
        "image_url": "./assets/babycream.gif"
      },
    
      {
        "item": "makeup remover",
        "positionchanges": 2,
        "color": "clear, purple, metallic",
        "material": "plastic",
        "MDM": "MOVES"
      },
      {
        "item": "lip balm",
        "positionchanges": 2,
        "color": "white, pink",
        "material": "plastic",
        "MDM": "DOESN'T MOVE",
        "image_url": "./assets/lipbalm.gif"
      },
      {
          "item": "lip mask",
          "positionchanges": 3,
          "color": "pink",
          "material": "plastic",
          "MDM": "MOVES",
          "image_url": "./assets/lipmask.gif"
        },
        {
          "item": "curl cream",
          "positionchanges": 0,
          "color": "tan, brown",
          "material": "plastic",
          "MDM": "DOESN'T MOVE",
          "image_url": "./assets/cccreamrender.png"
        },
        {
          "item": "cleansing oil",
          "positionchanges": 0,
          "color": "green, tan, white, clear",
          "material": "plastic",
          "MDM": "DOESN'T MOVE"
        },
    
        {
            "item": "eyedrops",
            "positionchanges": 3,
            "color": "teal, white",
            "material": "plastic",
            "MDM": "MOVES",
            "image_url": "./assets/eyedrops.gif"
          },
          {
            "item": "gua sha",
            "positionchanges": 2,
            "color": "pink",
            "material": "rose quartz",
            "MDM": "MOVES",
            "image_url": "./assets/guasha.gif"
          },
          {
              "item": "yuzu perfume",
              "positionchanges": 0,
              "color": "yellow-green",
              "material": "glass, metal",
              "MDM": "MOVES"
            },
            {
              "item": "blackberry & bay",
              "positionchanges": 0,
              "color": "clear, metallic, beige",
              "material": "glass, metal",
              "MDM": "DOESN'T MOVE",
              "image_url": "./assets/blackberrybay.gif"
            },
            {
              "item": "jo malone nectarine",
              "positionchanges": 0,
              "color": "clear, metallic, beige",
              "material": "glass, metal",
              "MDM": "DOESN'T MOVE",
              "image_url": "./assets/mini1.gif"
            },
    
            {
                "item": "jo malone blackberry",
                "positionchanges": 1,
                "color": "clear, metallic, beige",
                "material": "glass, metal",
                "MDM": "MOVES",
                "image_url": "./assets/mini2.gif"
              },
              {
                "item": "rollerball perfume",
                "positionchanges": 0,
                "color": "orange, clear, black",
                "material": "glass, plastic",
                "MDM": "DOESN'T MOVE"
              },
              {
                  "item": "makeup bag",
                  "positionchanges": 2,
                  "color": "gold, blue",
                  "material": "plastic",
                  "MDM": "MOVES",
                  "image_url": "./assets/makeupbag.gif"
                },
                {
                  "item": "coasters",
                  "positionchanges": 0,
                  "color": "red, silver",
                  "material": "metal",
                  "MDM": "DOESN'T MOVE",
                  "image_url": "./assets/coasters2render.png"
                },
                {
                  "item": "wet ones",
                  "positionchanges": 5,
                  "color": "yellow, white",
                  "material": "plastic, cotton",
                  "MDM": "MOVES"
                },
    
                {
                    "item": "hairtie",
                    "positionchanges": 4,
                    "color": "black",
                    "material": "cotton, rubber",
                    "MDM": "MOVES",
                    "image_url": "./assets/hairtie.gif"
                  },
                  {
                    "item": "herbal candy",
                    "positionchanges": 0,
                    "color": "silver, yellow",
                    "material": "metal",
                    "MDM": "DOESN'T MOVE",
                    "image_url": "./assets/herbalcandy.gif"
                  },
                  {
                      "item": "starface",
                      "positionchanges": 1,
                      "color": "blue, black",
                      "material": "plastic",
                      "MDM": "MOVES",
                      "image_url": "./assets/starfacerender.gif"
                    },
                    {
                      "item": "mug",
                      "positionchanges": 0,
                      "color": "white, gray",
                      "material": "ceramic",
                      "MDM": "DOESN'T MOVE"
                    },
                    {
                      "item": "coaster",
                      "positionchanges": 0,
                      "color": "tan, blue",
                      "material": "plastic, metal",
                      "MDM": "DOESN'T MOVE"
                    },
    
                    {
                        "item": "sunglasses",
                        "positionchanges": 0,
                        "color": "black",
                        "material": "plastic, velvet",
                        "MDM": "DOESN'T MOVE",
                        "image_url": "./assets/sunglassesrender.png"
                      },
                      {
                        "item": "headphones",
                        "positionchanges": 2,
                        "color": "black",
                        "material": "plastic, metal",
                        "MDM": "MOVES"
                      },
                      {
                          "item": "candle",
                          "positionchanges": 0,
                          "color": "white, metallic",
                          "material": "wax, glass",
                          "MDM": "DOESN'T MOVE"
                        },
                        {
                          "item": "toast lamp",
                          "positionchanges": 2,
                          "color": "white, brown",
                          "material": "plastic",
                          "MDM": "MOVES"
                        },
                        {
                          "item": "book1",
                          "positionchanges": 0,
                          "color": "yellow, white",
                          "material": "paper",
                          "MDM": "DOESN'T MOVE"
                        }
];


const imagePositions = {
    "organizer": { top: '180px', left: '0' },
    "toothbrush": { top: '350px', left: '0' },
    "toothpaste": { top: '500px', left: '9%' },
    "toner": { top: '800px', left: '-2%' },
    "face lotion": { top: '1050px', left: '10%' }, 
    "lip mask": { top: '150px', left: '30%' }, 
    "lip balm": { top: '1050px', left: '30%' },
    "curl cream": { top: '300px', left: '38%' },
    "eyedrops": { top: '550px', left: '-10%' },
    "gua sha": { top: '780px', left: '40%' },
    "blackberry & bay": { top: '200px', left: '60%' },
    "jo malone nectarine": { top: '500px', left: '40%' },
    "jo malone blackberry": { top: '280px', left: '22%' },
    "makeup bag": { top: '1040px', left: '60%' },
    "coasters": { top: '480px', left: '60%' },
    "hairtie": { top: '950px', left: '40%' },
    "herbal candy": { top: '820px', left: '58%' },
    "starface": { top: '600px', left: '70%' },
    "sunglasses": { top: '750px', left: '16%' },

    // Mobile positions
    "organizer-mobile": { top: '160px', left: '-10%' },
    "toothbrush-mobile": { top: '250px', left: '30%' },
    "toothpaste-mobile": { top: '450px', left: '-8%' },
    "toner-mobile": { top: '800px', left: '-2%' },
    "face lotion-mobile": { top: '1000px', left: '-10%' }, 
    "lip mask-mobile": { top: '150px', left: '35%' }, 
    "lip balm-mobile": { top: '1000px', left: '58%' },
    "curl cream-mobile": { top: '730px', left: '35%' },
    "eyedrops-mobile": { top: '600px', left: '-30%' },
    "gua sha-mobile": { top: '930px', left: '20%' },
    "blackberry & bay-mobile": { top: '170px', left: '63%' },
    "jo malone nectarine-mobile": { top: '370px', left: '30%' },
    "jo malone blackberry-mobile": { top: '300px', left: '-20%' },
    "makeup bag-mobile": { top: '800px', left: '62%' },
    "coasters-mobile": { top: '330px', left: '62%' },
    "hairtie-mobile": { top: '950px', left: '55%' },
    "herbal candy-mobile": { top: '670px', left: '72%' },
    "starface-mobile": { top: '500px', left: '55%' },
    "sunglasses-mobile": { top: '620px', left: '5%' },
    // Add more mobile positions as needed...
};

function generateFilterButtonsInDropdown(data, key) {
  const uniqueValues = [...new Set(data.flatMap(item => item[key].split(', ')))];
  const filterContainer = document.querySelector(`#${key}Filter .dropdown-content`);
  uniqueValues.forEach(value => {
      const button = document.createElement('button');
      button.textContent = value;
      button.classList.add('filterButton');
      button.dataset.filterKey = key;
      button.dataset.filterValue = value;
      button.addEventListener('click', (event) => {
          event.stopPropagation(); // Prevent event bubbling
          const isActive = button.classList.toggle('active'); // Toggle active state

          // Find corresponding parent dropdown button
          const dropdownButton = document.querySelector(`#${key}Filter .dropbtn`);

          // If this button is active, add active class to dropdown button
          if (isActive) {
              dropdownButton.classList.add('active');
          } else {
              // If this button is not active, check if any other buttons are active
              const activeButtons = document.querySelectorAll(`#${key}Filter .filterButton.active`);
              if (activeButtons.length === 0) {
                  dropdownButton.classList.remove('active'); // Remove active state from dropdown button if no active filters
              }
          }

          filterData(); // Refresh data display
      });

      filterContainer.appendChild(button);
  });
}

function generateMDMFilterButtonsInDropdown(data) {
  const mdmValues = [...new Set(data.map(item => item.MDM))];
  const mdmDropdownContainer = document.querySelector('#MDMFilter .dropdown-content');
  mdmValues.forEach(value => {
      const button = document.createElement('button');
      button.textContent = value;
      button.classList.add('filterButton');
      button.dataset.filterKey = 'MDM';
      button.dataset.filterValue = value;
      
      // Add event listener for MDM filter buttons
      button.addEventListener('click', (event) => {
          event.stopPropagation(); // Prevent event bubbling
          const isActive = button.classList.toggle('active'); // Toggle active state

          // Find corresponding parent dropdown button
          const dropdownButton = document.querySelector(`#MDMFilter .dropbtn`);

          // If this button is active, add active class to dropdown button
          if (isActive) {
              dropdownButton.classList.add('active');
          } else {
              // If this button is not active, check if any other buttons are active
              const activeButtons = document.querySelectorAll(`#MDMFilter .filterButton.active`);
              if (activeButtons.length === 0) {
                  dropdownButton.classList.remove('active'); // Remove active state from dropdown button if no active filters
              }
          }

          filterData(); // Refresh data display
      });

      mdmDropdownContainer.appendChild(button);
  });
}

// Filter data function
function filterData() {
  const activeFilters = document.querySelectorAll('.filterButton.active');
  const filteredData = jsonData.filter(item => {
      return Array.from(activeFilters).every(filterButton => {
          const filterKey = filterButton.dataset.filterKey;
          const filterValue = filterButton.dataset.filterValue;
          if (filterKey === 'MDM' && filterValue === "DOESN'T MOVE") {
              return item[filterKey] === filterValue;
          }
          if (filterKey === 'ID') {
              return item.item === filterValue;
          }
          return item[filterKey].includes(filterValue);
      });
  });

  const filteredItemsDiv = document.getElementById('filteredItems');
  filteredItemsDiv.innerHTML = '';
  filteredData.forEach(item => {
      const itemContainer = document.createElement('div');
      itemContainer.classList.add('filtered-item');
      if (item.image_url) {
          const imgElement = document.createElement('img');
          imgElement.src = item.image_url;
          imgElement.alt = item.item;
          imgElement.id = item.item.toLowerCase().replace(' ', '-').replace('&', '').replace(' ', '');
          itemContainer.appendChild(imgElement);
      }
      filteredItemsDiv.appendChild(itemContainer);
  });

  // Call setPositionsForFilteredItems after filtering
  setPositionsForFilteredItems();
}

// Generate filter buttons inside dropdown menu for Color and Materials
generateFilterButtonsInDropdown(jsonData, 'color');
generateFilterButtonsInDropdown(jsonData, 'material');

// Generate MDM filter buttons inside dropdown menu
generateMDMFilterButtonsInDropdown(jsonData);

// Add event listeners for dropdown buttons to toggle the active class and handle clear functionality
document.querySelectorAll('.dropbtn').forEach(dropdownButton => {
  dropdownButton.addEventListener('click', () => {
      const filterKey = dropdownButton.dataset.filterKey; // Get the filter key from the dropdown button
      const activeButtons = document.querySelectorAll(`#${filterKey}Filter .filterButton.active`);

      // If there are active buttons, clear their active states
      if (activeButtons.length > 0) {
          activeButtons.forEach(button => {
              button.classList.remove('active'); // Remove active class from filter buttons
          });
          dropdownButton.classList.remove('active'); // Remove active class from the dropdown button
      } else {
          // If no buttons are active, just toggle the dropdown button's active state
          dropdownButton.classList.toggle('active');
      }

      // Trigger data filtering after clearing selections or toggling the dropdown
      filterData();
  });
});




// Ensure filterData is called after each click to refresh the displayed items
filterData(); // Initial data display

function setPositionsForFilteredItems() {
  const filteredItems = document.querySelectorAll('.filtered-item');

  filteredItems.forEach(item => {
      const img = item.querySelector('img');
      if (img !== null) {
          const itemName = img.alt;
          console.log('Item Name:', itemName);

          // Determine if it's a mobile device
          const isMobile = window.matchMedia("(max-width: 768px)").matches;

          if (itemName in imagePositions) {
              const position = isMobile ? imagePositions[`${itemName}-mobile`] : imagePositions[itemName];
              img.style.top = position.top;
              img.style.left = position.left;
          }
      } else {
          console.error("Image element is null.");
      }
  });
}

function showTooltip(img, positionChanges) {
  // Remove any existing tooltips first
  hideTooltip();

  // Create a new tooltip element
  const tooltip = document.createElement('div');
  tooltip.textContent = `Position Changes: ${positionChanges}`;
  tooltip.classList.add('tooltip');

  // Position the tooltip relative to the image
  const imgRect = img.getBoundingClientRect();
  tooltip.style.top = `${imgRect.top - tooltip.offsetHeight}px`; // Adjust the position as needed
  tooltip.style.left = `${imgRect.left}px`;

  // Append the tooltip to the document body
  document.body.appendChild(tooltip);
}

function hideTooltip() {
  // Remove any existing tooltips from the document body
  const tooltip = document.querySelector('.tooltip');
  if (tooltip) {
      tooltip.remove();
  }
}
